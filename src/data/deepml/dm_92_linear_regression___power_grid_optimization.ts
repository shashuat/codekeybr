import { Problem } from '../../types';

export const DM_92_LINEAR_REGRESSION___POWER_GRID_OPTIMIZATION: Problem = {
  "id": "dm_92_linear_regression_power_grid_optimization",
  "title": "Linear Regression - Power Grid Optimization",
  "difficulty": "Medium",
  "tags": [
    "Linear Algebra",
    "Matrix Operations",
    "Optimization"
  ],
  "descriptionMarkdown": "It is the year 2157. Mars has its first thriving colony, and energy consumption is steadily on the rise. As the lead data scientist, you have daily power usage measurements for 10 days that are affected by both a growing linear trend and a known daily fluctuation.\n\nThe fluctuation follows the formula f(i) = 10 \u00d7 sin(2\u03c0 \u00d7 i / 10), where i is the day number (1 through 10).\n\nYour tasks:\n- Remove this known fluctuation from each data point (detrend the data).\n- Fit a linear regression model to the detrended data.\n- Predict day 15's base consumption using the fitted model.\n- Add back the fluctuation for day 15.\n- Round this predicted consumption, then apply a 5% safety margin and round up to the nearest integer.\n\nExample:\n- Input: Daily consumption data for 10 days: [150, 165, 185, 195, 210, 225, 240, 260, 275, 290]\n- Output: Running the provided solution code yields 404 for this dataset.",
  "solutionExplanation": "We first remove the known periodic component from the observed series to isolate the underlying linear trend. The fluctuation at day i is f(i) = 10 sin(2\u03c0i/10). For each observation y_i, we compute the detrended value y_i' = y_i \u2212 f(i). This yields a set of points that should lie near a straight line, enabling a reliable linear fit.\n\nWe then fit a simple univariate linear regression y' = a\u00b7x + b using the closed-form ordinary least squares solution derived from first principles: the slope a equals \u03a3(x\u2212x\u0304)(y'\u2212\u0233') / \u03a3(x\u2212x\u0304)^2 and the intercept b equals \u0233' \u2212 a\u00b7x\u0304. With the model trained, we predict the base consumption for day 15 (x = 15) as a\u00b715 + b. We add back the day-15 fluctuation f(15) to recover the full expected consumption, round this value, then apply a 5% safety margin and round up to ensure sufficient capacity. This sequence matches the problem\u2019s requirement and produces 404 on the provided example.",
  "solutionCode": "import torch\nimport math\n\ndef power_grid_forecast(consumption_data):\n    \"\"\"\n    Forecast day-15 consumption with detrending and linear regression, then add a 5% safety margin.\n\n    Steps:\n    1) Subtract known fluctuation f(i) = 10*sin(2*pi*i/10) from each data point (i=1..N).\n    2) Fit linear regression y' = a*x + b (closed-form OLS with tensor ops).\n    3) Predict base usage for day 15, add back f(15).\n    4) Round, then add a 5% safety margin and round up (ceil).\n\n    Args:\n        consumption_data (list or iterable of numbers): Daily consumption for 10 days.\n\n    Returns:\n        int: Final forecast with safety margin (integer, rounded up).\n    \"\"\"\n    # Convert input to torch tensors (float64 for numeric stability)\n    y = torch.tensor(consumption_data, dtype=torch.float64)\n    n = y.numel()\n    if n < 2:\n        raise ValueError(\"At least two days of data are required for linear regression.\")\n\n    # Day indices: 1..n\n    x = torch.arange(1, n + 1, dtype=torch.float64)\n\n    # Known fluctuation per day: 10 * sin(2*pi*i/10)\n    fluct = 10.0 * torch.sin(2.0 * math.pi * x / 10.0)\n\n    # Detrend observed data by removing fluctuation\n    y_detrended = y - fluct\n\n    # Closed-form OLS for simple linear regression (a: slope, b: intercept)\n    x_mean = x.mean()\n    y_mean = y_detrended.mean()\n    num = ((x - x_mean) * (y_detrended - y_mean)).sum()\n    den = ((x - x_mean) ** 2).sum()\n    if den.abs() < 1e-12:\n        raise ZeroDivisionError(\"Variance of x is too small for regression.\")\n    a = num / den\n    b = y_mean - a * x_mean\n\n    # Predict base consumption for day 15\n    x15 = torch.tensor(15.0, dtype=torch.float64)\n    base15 = a * x15 + b\n\n    # Add back day-15 fluctuation\n    fluc15 = 10.0 * torch.sin(2.0 * math.pi * x15 / 10.0)\n    pred15 = base15 + fluc15\n\n    # Round, then apply 5% safety margin and round up\n    rounded = torch.round(pred15)\n    with_margin = 1.05 * rounded\n    final_int = int(torch.ceil(with_margin).item())\n    return final_int\n\n\ndef solution():\n    # Example usage (matches the prompt example)\n    example_data = [150, 165, 185, 195, 210, 225, 240, 260, 275, 290]\n    return power_grid_forecast(example_data)\n",
  "timeComplexity": "O(N)",
  "spaceComplexity": "O(N)",
  "platform": "deepml"
};
